[sssd]
# Core configuration
config_file_version = 2
services = nss, pam, ssh
domains  = $domain

# Debugging (for NSS)
[nss]
debug_level = 7

# -----------------------------------------------------------------------------
# Domain-specific settings for example.com
# -----------------------------------------------------------------------------
[domain/$domain]
# ─── Identity and Authentication ─────────────────────────────────────────────
id_provider      = ldap
auth_provider    = ldap
chpass_provider  = ldap
access_provider  = ldap

# LDAP servers and search bases
ldap_uri               = ldap://$ldap_ip
ldap_search_base       = $base_dn
ldap_user_search_base  = ou=People,$base_dn
ldap_group_search_base = ou=Groups,$base_dn

# Credentials for binding to LDAP
ldap_default_bind_dn      = cn=sssd-binder,ou=ServiceAccounts,$base_dn
ldap_default_authtok      = $sssd_binder_password
ldap_default_authtok_type = password

# ─── Access control ───────────────────────────────────────────────────────────
# Only allow users matching this filter to log in
ldap_access_filter = (objectClass=*)

# ─── SSH public key lookup ────────────────────────────────────────────────────
ldap_user_ssh_public_key = sshPublicKey

# ─── Group mapping ─────────────────────────────────────────────────────────────
ldap_group_object_class = posixGroup
ldap_group_member       = memberUid
ldap_group_name         = cn

# ─── Caching and performance ──────────────────────────────────────────────────
cache_credentials   = true
entry_cache_timeout = 600
enumerate           = false

# ─── Schema type ───────────────────────────────────────────────────────────────
ldap_schema = rfc2307

